<!DOCTYPE html>

<html>
    <head>
        <!--
        Implement window in-place resize for kills
            Fill open space when window is removed
            On kill, if window has children, expand children to fill space
        Remove "float: left" and set hard positions "top: 5px; left: 5px;"
        Create i3bar && i3status
        Implement multiple workspaces
        Implement window floating
            Resize should build array of windows with this.float = false && only affect those windows
        
        
        -->
        <title>i3wm</title>
        <script src="jquery-2.0.3.js"></script>
        <script type="text/javascript">
            function Time() {
                var recurring = setInterval(function(){
                    var current = new Date();
                    var h = this.addzero(current.getHours());
                    var m = this.addzero(current.getMinutes());
                    var s = this.addzero(current.getSeconds());
                    var Y = this.addzero(current.getFullYear());
                    var M = this.addzero(current.getMonth());
                    var D = this.addzero(current.getDay());
                    $(".time").html(h+":"+m+":"+s+" "+D+"."+M+"."+Y);
                },1000);
                this.addzero = function(arg) {
                    if (arg < 10) {
                        arg = "0"+arg;
                    }
                    return(arg);
                }
            }
            function Site() {
                this.child = [];
                this.direction = "right";
                this.focus = "none";
                this.focusws = "none";
            }
            function Workspace(name) {
                this.child = [];
                this.parent = site;
                this.parent.child.push(this);
                this.name = name;
                this.type = "workspace"
                this.focus = true;
                site.focusws = this;
                this.windows = [];
                this.workspace = this;

                this.create = function() {
                    this.width = $(window).width();
                    this.height = $(window).height()-$(".bar").height();
                    $("body").append("<div class=\"workspace\" id=\""+this.name+"\"></div>");
                    this.html = $("#"+this.name);
                    this.html.height(this.height);
                    this.html.width(this.width);
                    $(".bar .left").append(this.name);

                }

                if (this.focus == false && this.child.length == 0) {
                    for (var i = 0; i < site.child.length; i++) {
                        if (site.child[i] == this) {
                            site.child.splice(i,1);
                            break;
                        }
                    }
                }
            }

            function NewWindowSize(newwindow) {
                
                var q = newwindow.parent.child.length+1;
                if (newwindow.parent.type == "workspace") {
                    q -= 1;
                }
                
                console.log("Number of Windows to be resized: "+q);

                var totalx = 0;
                var totaly = 0;

                for (var i = 0; i < newwindow.parent.child.length; i++) {
                    if (newwindow.parent.child[i] != newwindow) {
                        totalx += newwindow.parent.child[i].width;
                        totaly += newwindow.parent.child[i].height;
                    }
                }

                if (newwindow.parent.type == "window") {
                    totalx += newwindow.parent.width;
                    totaly += newwindow.parent.height;
                }
                else if (newwindow.parent.type == "workspace" && newwindow.parent.child.length == 1) {
                    totalx = newwindow.parent.width;
                    totaly = newwindow.parent.height;
                }

                if (site.direction == "right") {
                    newwindow.width = totalx/q;
                    newwindow.height = newwindow.parent.height;
                }
                else {
                    newwindow.height = totaly/q;
                    newwindow.width = newwindow.parent.width;
                }
                
                for (var i = 0; i < newwindow.parent.child.length; i++) {
                    if (site.direction == "right" && newwindow.parent.child[i] != newwindow) {
                        newwindow.parent.child[i].width = newwindow.parent.child[i].width-newwindow.width/(q-1);
                    }
                    else if (newwindow.parent.child[i] != newwindow && site.direction !="right") {
                        newwindow.parent.child[i].height = newwindow.parent.child[i].height-newwindow.height/(q-1);
                    }
                }
                if (newwindow.parent.type != "workspace") {
                    if (site.direction == "right") {
                        newwindow.parent.width = newwindow.parent.width-newwindow.width/(q-1);
                    }
                    else {
                        newwindow.parent.height = newwindow.parent.height-newwindow.height/(q-1); 
                    }
                }
            }

            function ResizeAll() {
                for (var i = 0; i < site.child.length; i++) {
                    for (var j = 0; j < site.child[i].windows.length; j++) {
                        var ref = site.child[i].windows[j];
                        $("#"+ref.id+ref.type).css('height',ref.height+'px').css('width',ref.width+'px');
                    }
                }
            }

            function AssignParent(newwindow) {
                 
                if (site.focus.direction != site.direction && (site.focus.direction == "right" || site.focus.direction == "down")) {
                    newwindow.parent = site.focus;
                }
                else if (site.focus.direction == site.direction) {
                    newwindow.parent = site.focus.parent;
                }
                else {
                    newwindow.parent = site.focusws;
                }
            }
            
            function Window() {
                AssignParent(this);
                this.parent.child.push(this);
                this.child = [];
                this.type = "window";
                this.float = false;
                this.direction = site.direction;
                NewWindowSize(this);
                this.id = site.child[0].windows.length;
                this.workspace = this.parent.workspace;
                
                this.create = function() {
                    var r1 = Math.floor(Math.random()*16).toString(16);
                    var r2 = Math.floor(Math.random()*16).toString(16);
                    var g1 = Math.floor(Math.random()*16).toString(16);
                    var g2 = Math.floor(Math.random()*16).toString(16);
                    var b1 = Math.floor(Math.random()*16).toString(16);
                    var b2 = Math.floor(Math.random()*16).toString(16);
                    console.log(r1+r2+g1+g2+b1+b2);
                    
                    if (this.workspace.windows.length == 0) {
                        $(".workspace").append("<div class=\"window\" id=\""+this.id+this.type+"\"></div>");
                    }
                    else {
                        site.focus.html.after("<div class=\"window\" id=\""+this.id+this.type+"\"></div>");
                    }
                    this.html = $("#"+this.id+this.type);
                    this.html.css("background-color", "#"+r1+r2+b1+b2+g1+g2);
                }
                
                this.create();
                
                for (var i = 0; i < this.workspace.windows.length; i++) {
                    this.workspace.windows[i].focus = false;
                }
                
                this.focus = true;
                site.focus = this;
                
                var currentwindow = this;
                $("#"+this.id+this.type).mouseover(function() {
                    site.focus = currentwindow;
                });
                
                this.kill = function() {
                    if (this.child.length != 0) {
                        for (var i = 0; i < this.child.length; i++) {
                            if (i == 0) {
                                this.child[i].parent = this.parent;
                            }
                            else {
                                this.child[0].child.push(this.child[i]);
                                this.child[i].parent = this.child[0];
                            }
                        }
                    }
                    else {
                        var includeparent = -1;
                        if (this.parent.type == "window") {
                            includeparent = 0;
                            if (this.direction == "right") {
                                this.parent.width += this.width/this.parent.child.length;
                            }
                            else {
                                this.parent.height += this.height/this.parent.child.length;
                            }
                        }
                        for (var i = 0; i < this.parent.child.length; i++) {
                            if (this.direction == "right") {
                                this.parent.child[i].width += this.width/(this.parent.child.length+includeparent);
                            }
                            else {
                                this.parent.child[i].height += this.height/(this.parent.child.length+includeparent);
                            }
                        }

                    }
                    for (var i = 0; i < this.parent.child.length; i++) {
                        if (this.parent.child[i] == this) {
                            this.parent.child.splice(i,1);
                        }
                    }
                    for (var i = 0; i < this.workspace.windows.length; i++) {
                        if (this.workspace.windows[i] == this) {
                            this.workspace.windows.splice(i,1);
                        }
                    }
                    $("#"+this.id+this.type).remove();
                }
            }
            /*
            function RisingEdge(arg) {
                this.current_in;
                this.previous_in;
                this.current_out;
                if (arg) {
                    this.previous_in = this.current_in;
                    this.current_in = true;
                }
                else {
                    this.previous_in = this.current_in;
                    this.current_in = false;
                }
                if (this.current_in == true && this.previous_in == false) {
                    return(true);
                }
                else {
                    return(false);
                }
            }
            */
            Time();
            var site = new Site();
            new Workspace("1");
            
            $(document).ready(function(){
                site.child[0].create();
                $('body').keydown(function(e){
                    if (e.altKey) {
                        if (e.keyCode == "13") {
                            for (var i = 0; i < site.child.length; i++) {
                                if (site.child[i].focus) {
                                    site.child[i].windows.push(new Window());
                                    ResizeAll();
                                    break;
                                }
                            }
                        }
                        else if (e.keyCode == "81") {
                            var wid = site.focus.id;
                            var next = 0;
                            for (var i = 0; i < site.focus.parent.child.length; i++) {
                                if (site.focus.parent.child[i].id == wid-1) {
                                    next = site.focus.parent.child[i];
                                    break;
                                }
                                if (site.focus.parent.child[i].id == wid+1) {
                                    next = site.focus.parent.child[i];
                                }
                            }
                            site.focus.kill();
                            site.focus = next;
                            ResizeAll();
                        }
                        else if (e.keyCode == "72") {
                            site.direction = "right";
                        }
                        else if (e.keyCode == "86") {
                            site.direction = "down";
                        }
                    }
                });
            });
        </script>
        <style>
            * {
                border-width: 1px;
                border-color: #2d2d2d;
                border-style: solid;
            }
            html,
            body {
                font-family: Droid Sans Mono;
                background-color: #2d2d2d;
                color: #e5e5e5;
                height: 100%;
                margin: 0px;
                padding: 0px;
                overflow: hidden;
            }
            .bar {
                height: 20px;
                font-size: 12px;
            }
            .left,
            .right {
                margin-top: 3px;
                margin-left: 3px;
                margin-right: 3px;
            }
            .left {
                float: left;
            }
            .right {
                float: right;
            }
            .workspace {
                height: 100%;
                width: 100%;
            }
            .window {
                height: 100%;
                width: 100%;
                float: left;
            }
        </style>
    </head>
    
    <body>
        <div class="bar"><span class="left"></span><span class="right"><span class="time"></span></span></div>
        <div class="page"></div>
    </body>
</html>
